<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Request | TechGrid Systems</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,900&display=swap');
        
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1e293b; }
        
        /* Updated Logo Style to match image_d71b3e.png */
        .logo-text {
            font-family: 'Inter', sans-serif;
            font-weight: 900;
            font-style: italic;
            letter-spacing: -0.05em;
            text-transform: uppercase;
        }

        /* Navigation alignment like image_d5b6fc.png */
        .nav-link {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 600;
            color: #94a3b8;
            transition: color 0.2s;
        }
        .nav-link:hover, .nav-link.active {
            color: white;
        }

        .type-card {
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            border: 2px solid transparent;
        }
        .type-card:hover {
            transform: translateY(-5px);
            border-color: #3b82f6;
            background-color: #ffffff;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.05);
        }

        #form-container { display: none; }
        .animate-slideUp { animation: slideUp 0.4s ease-out forwards; }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Custom scrollbar for better UI */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- HEADER updated to match branding in image_d5b6fc.png and logo image_d71b3e.png -->
    <header class="bg-[#111827] text-white px-6 md:px-12 h-20 flex items-center justify-between sticky top-0 z-50 shadow-lg">
        <div class="flex items-center space-x-12">
            <!-- Logo Section -->
            <div class="flex items-center cursor-pointer" onclick="navigateTo('home.html')">
                <span class="logo-text text-2xl tracking-tighter">
                    TECHGRID <span class="text-blue-500">SYSTEMS</span>
                </span>
            </div>
            
            <!-- Navigation Section -->
            <nav class="hidden lg:flex items-center space-x-8">
                <a href="javascript:void(0)" onclick="navigateTo('home.html')" class="nav-link">
                    <i class="fas fa-home text-sm"></i> Home
                </a>
                <a href="javascript:void(0)" onclick="navigateTo('new-request.html')" class="nav-link active">
                    <i class="fas fa-plus-circle text-sm"></i> New Request
                </a>
                <a href="javascript:void(0)" onclick="navigateTo('history.html')" class="nav-link">
                    <i class="fas fa-file-alt text-sm"></i> My Requests
                </a>
                <a href="javascript:void(0)" class="nav-link">
                    <i class="fas fa-lightbulb text-sm"></i> Solutions
                </a>
            </nav>
        </div>

        <div class="flex items-center space-x-4">
            <div id="user-pill" class="flex items-center text-[11px] bg-slate-800 border border-slate-700 px-4 py-2 rounded text-slate-300 font-bold tracking-wider uppercase">
                <i class="fas fa-user-circle mr-2 text-blue-400"></i>
                USER: <span id="user-display-name" class="ml-1">LOADING...</span>
            </div>
            <button onclick="navigateTo('new-request.html')" class="hidden md:flex items-center px-5 py-2.5 bg-[#ef4444] text-white rounded font-bold text-xs uppercase tracking-widest hover:bg-red-600 transition shadow-lg">
                <i class="fas fa-headset mr-2"></i> New Request
            </button>
        </div>
    </header>

    <main class="flex-grow max-w-5xl mx-auto w-full p-8 md:p-12">
        <div class="mb-12">
            <h1 class="text-4xl font-black text-slate-900 mb-2 tracking-tight">Submit a Request</h1>
            <p class="text-slate-500 font-medium">Select a category below to receive specialized assistance from our teams.</p>
        </div>

        <!-- STEP 1: SELECT TYPE -->
        <div id="selection-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-12">
            <div onclick="showForm('tech')" class="type-card bg-white p-8 rounded-2xl border-slate-200 shadow-sm flex items-start space-x-5">
                <div class="w-14 h-14 bg-blue-50 text-blue-600 rounded-xl flex items-center justify-center text-2xl flex-shrink-0">
                    <i class="fas fa-microchip"></i>
                </div>
                <div>
                    <h3 class="font-bold text-slate-900 text-lg mb-1">Technical Support</h3>
                    <p class="text-sm text-slate-500 leading-relaxed">Hardware repairs, software installations, or network connectivity issues.</p>
                </div>
            </div>

            <div onclick="showForm('account')" class="type-card bg-white p-8 rounded-2xl border-slate-200 shadow-sm flex items-start space-x-5">
                <div class="w-14 h-14 bg-indigo-50 text-indigo-600 rounded-xl flex items-center justify-center text-2xl flex-shrink-0">
                    <i class="fas fa-user-shield"></i>
                </div>
                <div>
                    <h3 class="font-bold text-slate-900 text-lg mb-1">Account & Access</h3>
                    <p class="text-sm text-slate-500 leading-relaxed">New user onboarding, password resets, or permission changes.</p>
                </div>
            </div>

            <div onclick="showForm('billing')" class="type-card bg-white p-8 rounded-2xl border-slate-200 shadow-sm flex items-start space-x-5">
                <div class="w-14 h-14 bg-emerald-50 text-emerald-600 rounded-xl flex items-center justify-center text-2xl flex-shrink-0">
                    <i class="fas fa-file-invoice-dollar"></i>
                </div>
                <div>
                    <h3 class="font-bold text-slate-900 text-lg mb-1">Accounting & Finance</h3>
                    <p class="text-sm text-slate-500 leading-relaxed">Invoice inquiries, payment processing, or budget approvals.</p>
                </div>
            </div>

            <div onclick="showForm('feedback')" class="type-card bg-white p-8 rounded-2xl border-slate-200 shadow-sm flex items-start space-x-5">
                <div class="w-14 h-14 bg-amber-50 text-amber-600 rounded-xl flex items-center justify-center text-2xl flex-shrink-0">
                    <i class="fas fa-comments"></i>
                </div>
                <div>
                    <h3 class="font-bold text-slate-900 text-lg mb-1">Communication</h3>
                    <p class="text-sm text-slate-500 leading-relaxed">General feedback, internal communications, or suggestion box.</p>
                </div>
            </div>
        </div>

        <!-- STEP 2: DYNAMIC FORM -->
        <div id="form-container" class="bg-white rounded-3xl shadow-xl border border-slate-100 overflow-hidden animate-slideUp">
            <div class="bg-slate-50 px-10 py-6 border-b border-slate-100 flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <div id="form-icon-container" class="w-8 h-8 rounded-lg flex items-center justify-center text-white">
                        <i id="form-icon" class="fas fa-tools text-xs"></i>
                    </div>
                    <span id="selected-type-label" class="text-xs font-black uppercase tracking-widest text-slate-700">Technical Support</span>
                </div>
                <button onclick="resetSelection()" class="text-xs font-bold text-blue-600 hover:text-blue-800 transition flex items-center">
                    <i class="fas fa-arrow-left mr-2"></i> Change Category
                </button>
            </div>
            
            <form id="request-form" class="p-10 space-y-8">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="space-y-2">
                        <label class="block text-[10px] font-black uppercase tracking-widest text-slate-400 ml-1">Request Subject</label>
                        <input type="text" id="ticket-subject" required placeholder="Short summary of your request" 
                               class="w-full px-5 py-4 bg-slate-50 border border-slate-200 rounded-xl focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 outline-none transition-all font-medium">
                    </div>
                    <div class="space-y-2">
                        <label class="block text-[10px] font-black uppercase tracking-widest text-slate-400 ml-1">Priority Level</label>
                        <select id="ticket-urgency" class="w-full px-5 py-4 bg-slate-50 border border-slate-200 rounded-xl focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 outline-none transition-all font-medium appearance-none">
                            <option>Standard Priority</option>
                            <option>Medium - Timely Action</option>
                            <option>High - Business Critical</option>
                            <option>Urgent - Immediate Attention</option>
                        </select>
                    </div>
                </div>

                <div class="space-y-2">
                    <label id="desc-label" class="block text-[10px] font-black uppercase tracking-widest text-slate-400 ml-1">Detailed Description</label>
                    <textarea id="ticket-description" rows="6" required class="w-full px-5 py-4 bg-slate-50 border border-slate-200 rounded-xl focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 outline-none transition-all font-medium resize-none" 
                              placeholder="Describe the situation in detail..."></textarea>
                </div>

                <div class="pt-4 flex items-center justify-between border-t border-slate-50 pt-8">
                    <p class="text-xs text-slate-400 font-medium">
                        <i class="fas fa-info-circle mr-1"></i> Submitting as <span id="user-tag" class="text-slate-600 font-bold">GUEST</span>
                    </p>
                    <button type="submit" class="w-full md:w-auto px-10 py-4 bg-blue-600 text-white font-black uppercase tracking-widest rounded-xl hover:bg-blue-700 transition shadow-lg shadow-blue-200 flex items-center justify-center">
                        Submit Ticket <i class="fas fa-paper-plane ml-3 text-xs opacity-70"></i>
                    </button>
                </div>
            </form>
        </div>
    </main>

    <script>
        let currentType = '';

        function verifySession() {
            const urlParams = new URLSearchParams(window.location.search);
            let currentUser = urlParams.get('username') || localStorage.getItem('techgrid_user');

            if (currentUser && currentUser !== "null") {
                const cleanName = decodeURIComponent(currentUser).replace(/['"]+/g, '');
                localStorage.setItem('techgrid_user', cleanName);
                document.getElementById('user-display-name').innerText = cleanName.toUpperCase();
                document.getElementById('user-tag').innerText = cleanName;
            } else {
                window.location.href = "login.html";
            }
        }

        window.navigateTo = (page) => {
            const user = localStorage.getItem('techgrid_user');
            window.location.href = user ? `${page}?username=${encodeURIComponent(user)}` : page;
        };

        window.showForm = (type) => {
            currentType = type;
            const grid = document.getElementById('selection-grid');
            const container = document.getElementById('form-container');
            const label = document.getElementById('selected-type-label');
            const descLabel = document.getElementById('desc-label');
            const iconContainer = document.getElementById('form-icon-container');
            const icon = document.getElementById('form-icon');

            grid.style.display = 'none';
            container.style.display = 'block';

            switch(type) {
                case 'tech':
                    label.innerText = "Technical Support Request";
                    descLabel.innerText = "Issue Details & Steps to Reproduce";
                    iconContainer.className = "w-8 h-8 rounded-lg flex items-center justify-center text-white bg-blue-600";
                    icon.className = "fas fa-microchip text-xs";
                    break;
                case 'account':
                    label.innerText = "Account / Access Request";
                    descLabel.innerText = "User details and required permissions";
                    iconContainer.className = "w-8 h-8 rounded-lg flex items-center justify-center text-white bg-indigo-600";
                    icon.className = "fas fa-user-shield text-xs";
                    break;
                case 'billing':
                    label.innerText = "Accounting & Finance Request";
                    descLabel.innerText = "Invoice number or finance query details";
                    iconContainer.className = "w-8 h-8 rounded-lg flex items-center justify-center text-white bg-emerald-600";
                    icon.className = "fas fa-file-invoice-dollar text-xs";
                    break;
                case 'feedback':
                    label.innerText = "Communication / Feedback";
                    descLabel.innerText = "Your comments or suggestions";
                    iconContainer.className = "w-8 h-8 rounded-lg flex items-center justify-center text-white bg-amber-600";
                    icon.className = "fas fa-comments text-xs";
                    break;
            }
            window.scrollTo({ top: 100, behavior: 'smooth' });
        };

        window.resetSelection = () => {
            document.getElementById('selection-grid').style.display = 'grid';
            document.getElementById('form-container').style.display = 'none';
            document.getElementById('request-form').reset();
        };

        document.getElementById('request-form').onsubmit = function(e) {
            e.preventDefault();
            
            const ticket = {
                id: Math.random().toString(36).substr(2, 9),
                user: localStorage.getItem('techgrid_user'),
                subject: document.getElementById('ticket-subject').value,
                category: currentType.toUpperCase(),
                description: document.getElementById('ticket-description').value,
                status: 'Pending Review',
                timestamp: new Date().toISOString()
            };

            const existing = JSON.parse(localStorage.getItem('techgrid_tickets') || '[]');
            existing.push(ticket);
            localStorage.setItem('techgrid_tickets', JSON.stringify(existing));

            // Feedback UI instead of alert
            const btn = e.submitter;
            btn.innerHTML = 'Submitting...';
            btn.disabled = true;

            setTimeout(() => {
                navigateTo('history.html');
            }, 800);
        };

        window.onload = verifySession;
    </script>
</body>
</html>
